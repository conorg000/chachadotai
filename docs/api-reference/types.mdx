---
title: 'Types & Data Contracts'
description: 'TypeScript types and data contracts for the SafetyLayer SDK and ChaCha backend'
---

## Overview

The **SafetyLayer SDK** uses types from the `@safetylayer/contracts` package, which defines the API contracts between the SDK and ChaCha backend. This ensures type safety across your entire integration.

## Importing Types

### From SDK

```typescript
import type {
  EventType,
  Role,
  RecordEventResponse,
  EvaluateResponse,
  PolicyAction,
} from '@safetylayer/core';
```

### From Contracts Package

```typescript
import type {
  Event,
  Session,
  RiskSnapshot,
  CoTAnalysis,
  Project,
  Policy,
} from '@safetylayer/contracts';
```

## SDK Types

These types are used when interacting with the SafetyLayer client:

### Event Types

```typescript
type EventType =
  | 'message.user'
  | 'message.assistant'
  | 'cot'
  | 'tool_call'
  | 'policy_decision';
```

<ParamField path="message.user" type="literal">
  User message event
</ParamField>

<ParamField path="message.assistant" type="literal">
  Assistant response event
</ParamField>

<ParamField path="cot" type="literal">
  Chain-of-thought reasoning event
</ParamField>

<ParamField path="tool_call" type="literal">
  Tool/function call event
</ParamField>

<ParamField path="policy_decision" type="literal">
  Policy decision event
</ParamField>

### Role

```typescript
type Role = 'user' | 'assistant';
```

### Policy Actions

```typescript
type PolicyAction = 'allow' | 'block' | 'flag' | null;
```

<ParamField path="allow" type="literal">
  Session is allowed to continue
</ParamField>

<ParamField path="block" type="literal">
  Session should be blocked
</ParamField>

<ParamField path="flag" type="literal">
  Session is flagged for review
</ParamField>

<ParamField path="null" type="null">
  No policy action taken
</ParamField>

## API Response Types

### RecordEventResponse

Response from `recordEvent()` and convenience methods:

```typescript
interface RecordEventResponse {
  ok: boolean;
  eventId: string;
  timestamp: number;
}
```

**Example:**
```typescript
const response = await safety.recordUserMessage(sessionId, 'Hello');
console.log(response.eventId);  // "evt_abc123"
```

### EvaluateResponse

Response from `evaluate()`:

```typescript
interface EvaluateResponse {
  riskScore: number;           // 0-1
  patterns: string[];          // Detected patterns
  action: PolicyAction;        // Policy decision
  reasons?: string[];          // Reasons for decision
  sessionId: string;
  timestamp: number;
}
```

**Example:**
```typescript
const decision = await safety.evaluate({ sessionId });

if (decision.action === 'block') {
  console.log('Blocked:', decision.reasons);
}
```

## Backend Data Models

These types represent backend data structures. They're returned by dashboard APIs but not directly used by the SDK client.

### Event

```typescript
interface Event {
  id: string;
  projectId: string;
  sessionId: string;
  type: EventType;
  role?: Role;
  content?: string;
  metadata?: Record<string, any>;
  createdAt: Date;
}
```

Events are the fundamental unit of recorded data.

### Session

```typescript
interface Session {
  id: string;
  projectId: string;
  currentRiskScore: number;
  currentPatterns: string[];
  lastActivityAt: Date;
  createdAt: Date;
}
```

Sessions group related events together.

### RiskSnapshot

```typescript
interface RiskSnapshot {
  id: string;
  sessionId: string;
  eventId?: string;
  riskScore: number;
  patterns: string[];
  analysis?: string;
  createdAt: Date;
}
```

Risk snapshots capture risk state at specific points in time.

### CoTAnalysis

```typescript
interface CoTAnalysis {
  riskScore: number;
  labels: string[];         // e.g., 'cot_deception', 'goal_drift'
  indicators: string[];
  summary: string;
  timestamp: number;
}
```

CoT analysis examines reasoning processes.

## Pattern Labels

Common pattern identifiers returned by analysis:

### Behavioral Patterns

- `gradual_escalation` - Progressive boundary testing
- `reconnaissance` - Information gathering
- `social_engineering` - Manipulation attempts
- `policy_probing` - Testing policy boundaries

### CoT Patterns

- `cot_deception` - Deceptive reasoning
- `goal_drift` - Shifting away from intended purpose
- `policy_evasion` - Attempting to circumvent policies
- `hidden_intent` - Concealed objectives

## Type Validation

The SDK performs request validation using Zod schemas from `@safetylayer/contracts`. If you need to validate data yourself:

```typescript
import {
  RecordEventRequestSchema,
  EvaluateRequestSchema,
} from '@safetylayer/contracts';

// Validate before sending
const result = RecordEventRequestSchema.safeParse(requestData);

if (!result.success) {
  console.error('Invalid request:', result.error);
}
```

## Complete Type Examples

### Recording Events with Full Types

```typescript
import type {
  EventType,
  Role,
  RecordEventResponse,
} from '@safetylayer/core';

async function recordMessage(
  sessionId: string,
  role: Role,
  content: string
): Promise<RecordEventResponse> {
  const type: EventType = role === 'user' 
    ? 'message.user' 
    : 'message.assistant';

  return await safety.recordEvent({
    sessionId,
    type,
    role,
    content,
  });
}
```

### Evaluation with Policy Actions

```typescript
import type {
  EvaluateResponse,
  PolicyAction,
} from '@safetylayer/core';

async function checkSession(sessionId: string): Promise<boolean> {
  const decision: EvaluateResponse = await safety.evaluate({ sessionId });

  const action: PolicyAction = decision.action;

  switch (action) {
    case 'block':
      console.log('Blocking session');
      return false;
    case 'flag':
      console.log('Flagging for review');
      return true;
    case 'allow':
    case null:
      return true;
  }
}
```

## Related

<CardGroup cols={2}>
  <Card
    title="SDK Client API"
    icon="code"
    href="/api-reference/safetylayer-client"
  >
    Main SDK reference
  </Card>
  
  <Card
    title="Contracts Package"
    icon="file-contract"
    href="https://github.com/conorg000/chachadotai/tree/main/packages/contracts"
  >
    Full contracts documentation
  </Card>
  
  <Card
    title="Error Handling"
    icon="triangle-exclamation"
    href="/api-reference/error-handling"
  >
    Error types and handling
  </Card>
  
  <Card
    title="Integration Guide"
    icon="puzzle-piece"
    href="/guides/integration"
  >
    Integration patterns
  </Card>
</CardGroup>
